/*
SQLyog Ultimate v12.09 (64 bit)
MySQL - 5.7.9 : Database - registroventasweb_des_multi
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`registroventasweb_des_multi` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `registroventasweb_des_multi`;

/*Table structure for table `v_cabecera` */

DROP TABLE IF EXISTS `v_cabecera`;

/*!50001 DROP VIEW IF EXISTS `v_cabecera` */;
/*!50001 DROP TABLE IF EXISTS `v_cabecera` */;

/*!50001 CREATE TABLE  `v_cabecera`(
 `id` int(11) ,
 `est_esecuencia` int(11) ,
 `est_desc` varchar(50) ,
 `est_fec_estactual` datetime ,
 `est_fec_ing` datetime ,
 `diastranscurridos` int(7) ,
 `cli_id` int(11) ,
 `cli_nom` varchar(100) ,
 `ConFactura` tinyint(1) ,
 `comision` tinyint(1) 
)*/;

/*Table structure for table `v_cuentasdebehaber` */

DROP TABLE IF EXISTS `v_cuentasdebehaber`;

/*!50001 DROP VIEW IF EXISTS `v_cuentasdebehaber` */;
/*!50001 DROP TABLE IF EXISTS `v_cuentasdebehaber` */;

/*!50001 CREATE TABLE  `v_cuentasdebehaber`(
 `id_cabecera` int(11) ,
 `nombre_cta` varchar(200) ,
 `tipo` varchar(20) ,
 `debe` double ,
 `haber` double ,
 `saldo` double 
)*/;

/*Table structure for table `v_detallecuentas` */

DROP TABLE IF EXISTS `v_detallecuentas`;

/*!50001 DROP VIEW IF EXISTS `v_detallecuentas` */;
/*!50001 DROP TABLE IF EXISTS `v_detallecuentas` */;

/*!50001 CREATE TABLE  `v_detallecuentas`(
 `id_transaccion` int(11) ,
 `id_cuenta` int(10) ,
 `nombre_cuenta` varchar(200) ,
 `nro_pedido` int(11) ,
 `glosa` varchar(250) ,
 `fecha_ingreso` datetime ,
 `debe` double ,
 `haber` double 
)*/;

/*Table structure for table `v_indicadorespedido` */

DROP TABLE IF EXISTS `v_indicadorespedido`;

/*!50001 DROP VIEW IF EXISTS `v_indicadorespedido` */;
/*!50001 DROP TABLE IF EXISTS `v_indicadorespedido` */;

/*!50001 CREATE TABLE  `v_indicadorespedido`(
 `id_cabecera` int(11) ,
 `Subtotal` double ,
 `iva` double ,
 `totalAPagar` double ,
 `PagadoCLiente` double ,
 `SaldoCLiente` double ,
 `CostoTotal` double ,
 `AbonadoFabrica` double ,
 `SaldoFabrica` double ,
 `Ganancia100` double ,
 `recibidoVendedor1` double ,
 `gananciaVendedor1` double ,
 `SaldoVendedor1` double ,
 `recibidoVendedor2` double ,
 `gananciaVendedor2` double ,
 `SaldoVendedor2` double 
)*/;

/*Table structure for table `v_listadopedido` */

DROP TABLE IF EXISTS `v_listadopedido`;

/*!50001 DROP VIEW IF EXISTS `v_listadopedido` */;
/*!50001 DROP TABLE IF EXISTS `v_listadopedido` */;

/*!50001 CREATE TABLE  `v_listadopedido`(
 `nro_pedido` int(11) ,
 `nom_cliente` varchar(100) ,
 `est_sec` int(11) ,
 `nom_estado` varchar(50) ,
 `dat_actualizacion` datetime ,
 `Cliente` double ,
 `Haber` double ,
 `Debe` double ,
 `Costo` double ,
 `Venta` double ,
 `Ganancia` double 
)*/;

/*Table structure for table `v_listadopedidoextendido` */

DROP TABLE IF EXISTS `v_listadopedidoextendido`;

/*!50001 DROP VIEW IF EXISTS `v_listadopedidoextendido` */;
/*!50001 DROP TABLE IF EXISTS `v_listadopedidoextendido` */;

/*!50001 CREATE TABLE  `v_listadopedidoextendido`(
 `numeroPedido` int(11) ,
 `cli_id` int(11) ,
 `cli_nom` varchar(100) ,
 `estado_sec` int(11) ,
 `est_desc` varchar(50) ,
 `est_fec_estactual` datetime ,
 `est_fec_ing` datetime ,
 `comision` tinyint(1) ,
 `confactura` tinyint(1) ,
 `Subtotal` double ,
 `iva` double ,
 `totalAPagar` double ,
 `PagadoCLiente` double ,
 `SaldoCLiente` double ,
 `CostoTotal` double ,
 `SaldoFabrica` double ,
 `Ganancia100` double ,
 `diastranscurridos` int(7) ,
 `SaldoGanancia` double ,
 `recibidoVendedor1` double ,
 `recibidoVendedor2` double ,
 `SaldoVendedor1` double ,
 `SaldoVendedor2` double 
)*/;

/*Table structure for table `v_resumenclientepedido` */

DROP TABLE IF EXISTS `v_resumenclientepedido`;

/*!50001 DROP VIEW IF EXISTS `v_resumenclientepedido` */;
/*!50001 DROP TABLE IF EXISTS `v_resumenclientepedido` */;

/*!50001 CREATE TABLE  `v_resumenclientepedido`(
 `id` int(11) ,
 `nom_cliente` varchar(100) ,
 `adr_cliente` varchar(100) ,
 `cant_pedidos` bigint(21) 
)*/;

/*Table structure for table `v_saldoscuentapedido` */

DROP TABLE IF EXISTS `v_saldoscuentapedido`;

/*!50001 DROP VIEW IF EXISTS `v_saldoscuentapedido` */;
/*!50001 DROP TABLE IF EXISTS `v_saldoscuentapedido` */;

/*!50001 CREATE TABLE  `v_saldoscuentapedido`(
 `id_cabecera` int(11) ,
 `id` int(10) ,
 `nombre_cta` varchar(200) ,
 `tipo_cta` varchar(20) ,
 `Entidad` varchar(50) ,
 `saldo` double 
)*/;

/*Table structure for table `v_totalcuentapedido` */

DROP TABLE IF EXISTS `v_totalcuentapedido`;

/*!50001 DROP VIEW IF EXISTS `v_totalcuentapedido` */;
/*!50001 DROP TABLE IF EXISTS `v_totalcuentapedido` */;

/*!50001 CREATE TABLE  `v_totalcuentapedido`(
 `id_cabecera` int(11) ,
 `tipo0` double ,
 `tipo1` double ,
 `tipo2` double 
)*/;

/*Table structure for table `v_totaldetallepedido` */

DROP TABLE IF EXISTS `v_totaldetallepedido`;

/*!50001 DROP VIEW IF EXISTS `v_totaldetallepedido` */;
/*!50001 DROP TABLE IF EXISTS `v_totaldetallepedido` */;

/*!50001 CREATE TABLE  `v_totaldetallepedido`(
 `id` int(11) ,
 `id_cabecera` int(11) ,
 `id_prod` int(11) ,
 `cod_prod` varchar(10) ,
 `nom_prod` varchar(100) ,
 `des_prod` varchar(1000) ,
 `costo_un` double ,
 `venta_un` double ,
 `cantidad` decimal(32,0) ,
 `det_costo` double ,
 `det_venta` double ,
 `det_ganancia` double ,
 `det_ganancia_2` double 
)*/;

/*Table structure for table `v_totaldetallepedido1linea` */

DROP TABLE IF EXISTS `v_totaldetallepedido1linea`;

/*!50001 DROP VIEW IF EXISTS `v_totaldetallepedido1linea` */;
/*!50001 DROP TABLE IF EXISTS `v_totaldetallepedido1linea` */;

/*!50001 CREATE TABLE  `v_totaldetallepedido1linea`(
 `id_cabecera` int(11) ,
 `costo_tot` double ,
 `venta_tot` double ,
 `iva_tot` double ,
 `ganancia_tot` double ,
 `ganancia2_tot` double 
)*/;

/*View structure for view v_cabecera */

/*!50001 DROP TABLE IF EXISTS `v_cabecera` */;
/*!50001 DROP VIEW IF EXISTS `v_cabecera` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_cabecera` AS select `cab`.`id` AS `id`,`est`.`secuencia` AS `est_esecuencia`,`est`.`descripcion` AS `est_desc`,`ce`.`fecha` AS `est_fec_estactual`,`cab`.`fecha_ingreso` AS `est_fec_ing`,(to_days(now()) - to_days(`cab`.`fecha_ingreso`)) AS `diastranscurridos`,`cli`.`id` AS `cli_id`,`cli`.`nombre` AS `cli_nom`,`cab`.`conFactura` AS `ConFactura`,`cab`.`comision` AS `comision` from (((`cabecera` `cab` join `cambioestado` `ce` on(((`cab`.`estadoActual` = `ce`.`id`) and (`cab`.`id` = `ce`.`id_cabecera`)))) join `estado` `est` on((`ce`.`estado` = `est`.`secuencia`))) join `cliente` `cli` on((`cab`.`id_cliente` = `cli`.`id`))) */;

/*View structure for view v_cuentasdebehaber */

/*!50001 DROP TABLE IF EXISTS `v_cuentasdebehaber` */;
/*!50001 DROP VIEW IF EXISTS `v_cuentasdebehaber` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_cuentasdebehaber` AS select `dp`.`id_cabecera` AS `id_cabecera`,`sal`.`nombre_cta` AS `nombre_cta`,`cta`.`Tipo` AS `tipo`,sum((case `cta`.`Tipo` when '0' then (`dp`.`venta_tot` + `dp`.`iva_tot`) when '1' then (case when (`cta`.`id` = `sal`.`id`) then `dp`.`ganancia2_tot` else 0 end) when '2' then (`dp`.`costo_tot` + `dp`.`iva_tot`) else 0 end)) AS `debe`,sum((case `cta`.`Tipo` when '0' then `sal`.`saldo` when '1' then (case when (`cta`.`id` = `sal`.`id`) then `sal`.`saldo` else 0 end) when '2' then `sal`.`saldo` else 0 end)) AS `haber`,sum(((case `cta`.`Tipo` when '0' then (`dp`.`venta_tot` + `dp`.`iva_tot`) when '1' then (case when (`cta`.`id` = `sal`.`id`) then `dp`.`ganancia2_tot` else 0 end) when '2' then (`dp`.`costo_tot` + `dp`.`iva_tot`) else 0 end) - (case `cta`.`Tipo` when '0' then `sal`.`saldo` when '1' then (case when (`cta`.`id` = `sal`.`id`) then `sal`.`saldo` else 0 end) when '2' then `sal`.`saldo` else 0 end))) AS `saldo` from ((`v_totaldetallepedido1linea` `dp` join `v_saldoscuentapedido` `sal` on((`dp`.`id_cabecera` = `sal`.`id_cabecera`))) join `cuenta` `cta` on((`sal`.`id` = `cta`.`id`))) group by `dp`.`id_cabecera`,`sal`.`nombre_cta` */;

/*View structure for view v_detallecuentas */

/*!50001 DROP TABLE IF EXISTS `v_detallecuentas` */;
/*!50001 DROP VIEW IF EXISTS `v_detallecuentas` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_detallecuentas` AS select `mov`.`id` AS `id_transaccion`,`cta`.`id` AS `id_cuenta`,`cta`.`Nombre` AS `nombre_cuenta`,`cab`.`id_cabecera` AS `nro_pedido`,`mov`.`glosa` AS `glosa`,`mov`.`fecha_ingreso` AS `fecha_ingreso`,(case when (`mov`.`monto` > 0) then `mov`.`monto` else 0 end) AS `debe`,(case when (`mov`.`monto` < 0) then `mov`.`monto` else 0 end) AS `haber` from ((`movimiento_cab` `cab` join `movimiento_cta` `mov` on((`cab`.`id` = `mov`.`id_cabecera`))) join `cuenta` `cta` on((`cta`.`id` = `mov`.`id_cuenta`))) order by `cab`.`id_cabecera`,`mov`.`fecha_ingreso` desc */;

/*View structure for view v_indicadorespedido */

/*!50001 DROP TABLE IF EXISTS `v_indicadorespedido` */;
/*!50001 DROP VIEW IF EXISTS `v_indicadorespedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_indicadorespedido` AS select `tot_det`.`id_cabecera` AS `id_cabecera`,sum(`tot_det`.`venta_tot`) AS `Subtotal`,sum((case `cab`.`ConFactura` when 1 then (`tot_det`.`venta_tot` * 0.19) else 0 end)) AS `iva`,sum((`tot_det`.`venta_tot` + (case `cab`.`ConFactura` when 1 then (`tot_det`.`venta_tot` * 0.19) else 0 end))) AS `totalAPagar`,sum(`cta_tipo0`.`saldo`) AS `PagadoCLiente`,sum(((`tot_det`.`venta_tot` + (case `cab`.`ConFactura` when 1 then (`tot_det`.`venta_tot` * 0.19) else 0 end)) - `cta_tipo0`.`saldo`)) AS `SaldoCLiente`,sum(`tot_det`.`costo_tot`) AS `CostoTotal`,sum(ifnull(`cta_tipo2`.`saldo`,0)) AS `AbonadoFabrica`,sum(((`tot_det`.`costo_tot` - ifnull(`cta_tipo2`.`saldo`,0)) + (case `cab`.`ConFactura` when 1 then (`tot_det`.`venta_tot` * 0.19) else 0 end))) AS `SaldoFabrica`,sum(`tot_det`.`ganancia_tot`) AS `Ganancia100`,sum(ifnull(`cta_tipo1_1`.`saldo`,0)) AS `recibidoVendedor1`,sum((case `cab`.`comision` when 0 then `tot_det`.`ganancia_tot` else `tot_det`.`ganancia2_tot` end)) AS `gananciaVendedor1`,sum(((case `cab`.`comision` when 0 then `tot_det`.`ganancia_tot` else `tot_det`.`ganancia2_tot` end) - ifnull(`cta_tipo1_1`.`saldo`,0))) AS `SaldoVendedor1`,sum(ifnull(`cta_tipo1_2`.`saldo`,0)) AS `recibidoVendedor2`,sum((case `cab`.`comision` when 1 then `tot_det`.`ganancia2_tot` else 0 end)) AS `gananciaVendedor2`,sum(((case `cab`.`comision` when 1 then `tot_det`.`ganancia2_tot` else 0 end) - ifnull(`cta_tipo1_2`.`saldo`,0))) AS `SaldoVendedor2` from (((((`v_cabecera` `cab` join `v_totaldetallepedido1linea` `tot_det` on((`cab`.`id` = `tot_det`.`id_cabecera`))) left join `v_saldoscuentapedido` `cta_tipo0` on(((`tot_det`.`id_cabecera` = `cta_tipo0`.`id_cabecera`) and (`cta_tipo0`.`tipo_cta` = 0)))) left join `v_saldoscuentapedido` `cta_tipo2` on(((`tot_det`.`id_cabecera` = `cta_tipo2`.`id_cabecera`) and (`cta_tipo2`.`tipo_cta` = 2)))) left join `v_saldoscuentapedido` `cta_tipo1_1` on(((`tot_det`.`id_cabecera` = `cta_tipo1_1`.`id_cabecera`) and (`cta_tipo1_1`.`tipo_cta` = 1) and (`cta_tipo1_1`.`Entidad` = 'VEN1')))) left join `v_saldoscuentapedido` `cta_tipo1_2` on(((`tot_det`.`id_cabecera` = `cta_tipo1_2`.`id_cabecera`) and (`cta_tipo1_2`.`tipo_cta` = 1) and (`cta_tipo1_2`.`Entidad` = 'VEN2')))) group by `tot_det`.`id_cabecera` */;

/*View structure for view v_listadopedido */

/*!50001 DROP TABLE IF EXISTS `v_listadopedido` */;
/*!50001 DROP VIEW IF EXISTS `v_listadopedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_listadopedido` AS select `cab`.`id` AS `nro_pedido`,`cab`.`cli_nom` AS `nom_cliente`,`cab`.`est_esecuencia` AS `est_sec`,`cab`.`est_desc` AS `nom_estado`,`cab`.`est_fec_estactual` AS `dat_actualizacion`,sum(`tot_cta`.`tipo0`) AS `Cliente`,sum(`tot_cta`.`tipo1`) AS `Haber`,sum(`tot_cta`.`tipo2`) AS `Debe`,sum(`tot_det`.`det_costo`) AS `Costo`,sum(`tot_det`.`det_venta`) AS `Venta`,sum(`tot_det`.`det_ganancia`) AS `Ganancia` from ((`v_cabecera` `cab` join `v_totalcuentapedido` `tot_cta` on((`cab`.`id` = `tot_cta`.`id_cabecera`))) join `v_totaldetallepedido` `tot_det` on((`cab`.`id` = `tot_det`.`id_cabecera`))) group by `cab`.`id`,`cab`.`cli_nom`,`cab`.`est_desc`,`cab`.`est_fec_estactual`,`cab`.`est_esecuencia` */;

/*View structure for view v_listadopedidoextendido */

/*!50001 DROP TABLE IF EXISTS `v_listadopedidoextendido` */;
/*!50001 DROP VIEW IF EXISTS `v_listadopedidoextendido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_listadopedidoextendido` AS select `cab`.`id` AS `numeroPedido`,`cab`.`cli_id` AS `cli_id`,`cab`.`cli_nom` AS `cli_nom`,`cab`.`est_esecuencia` AS `estado_sec`,`cab`.`est_desc` AS `est_desc`,`cab`.`est_fec_estactual` AS `est_fec_estactual`,`cab`.`est_fec_ing` AS `est_fec_ing`,`cab`.`comision` AS `comision`,`cab`.`ConFactura` AS `confactura`,`ind`.`Subtotal` AS `Subtotal`,`ind`.`iva` AS `iva`,`ind`.`totalAPagar` AS `totalAPagar`,ifnull(`ind`.`PagadoCLiente`,0) AS `PagadoCLiente`,ifnull(`ind`.`SaldoCLiente`,0) AS `SaldoCLiente`,ifnull(`ind`.`CostoTotal`,0) AS `CostoTotal`,ifnull(`ind`.`SaldoFabrica`,0) AS `SaldoFabrica`,ifnull(`ind`.`Ganancia100`,0) AS `Ganancia100`,(to_days(now()) - to_days(`cab`.`est_fec_ing`)) AS `diastranscurridos`,(ifnull(`ind`.`Ganancia100`,0) - (ifnull(`ind`.`recibidoVendedor1`,0) + ifnull(`ind`.`recibidoVendedor2`,0))) AS `SaldoGanancia`,ifnull(`ind`.`recibidoVendedor1`,0) AS `recibidoVendedor1`,ifnull(`ind`.`recibidoVendedor2`,0) AS `recibidoVendedor2`,ifnull(`ind`.`SaldoVendedor1`,0) AS `SaldoVendedor1`,ifnull(`ind`.`SaldoVendedor2`,0) AS `SaldoVendedor2` from (`v_indicadorespedido` `ind` join `v_cabecera` `cab` on((`cab`.`id` = `ind`.`id_cabecera`))) order by `cab`.`id` desc */;

/*View structure for view v_resumenclientepedido */

/*!50001 DROP TABLE IF EXISTS `v_resumenclientepedido` */;
/*!50001 DROP VIEW IF EXISTS `v_resumenclientepedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_resumenclientepedido` AS select `cli`.`id` AS `id`,`cli`.`nombre` AS `nom_cliente`,`cli`.`correo1` AS `adr_cliente`,count(`cab`.`id`) AS `cant_pedidos` from (`cliente` `cli` left join `cabecera` `cab` on((`cli`.`id` = `cab`.`id_cliente`))) group by `cli`.`id` */;

/*View structure for view v_saldoscuentapedido */

/*!50001 DROP TABLE IF EXISTS `v_saldoscuentapedido` */;
/*!50001 DROP VIEW IF EXISTS `v_saldoscuentapedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_saldoscuentapedido` AS select `cab`.`id_cabecera` AS `id_cabecera`,`cta`.`id` AS `id`,`cta`.`Nombre` AS `nombre_cta`,`cta`.`Tipo` AS `tipo_cta`,`cta`.`Entidad` AS `Entidad`,sum(`mov`.`monto`) AS `saldo` from ((`movimiento_cab` `cab` join `movimiento_cta` `mov` on((`cab`.`id` = `mov`.`id_cabecera`))) join `cuenta` `cta` on((`mov`.`id_cuenta` = `cta`.`id`))) group by `cab`.`id_cabecera`,`cta`.`id`,`cta`.`Nombre`,`cta`.`Tipo`,`cta`.`Entidad` order by `cta`.`Tipo` */;

/*View structure for view v_totalcuentapedido */

/*!50001 DROP TABLE IF EXISTS `v_totalcuentapedido` */;
/*!50001 DROP VIEW IF EXISTS `v_totalcuentapedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_totalcuentapedido` AS (select `cab`.`id_cabecera` AS `id_cabecera`,sum((case `cta1`.`Tipo` when 0 then `mov`.`monto` else 0 end)) AS `tipo0`,sum((case `cta1`.`Tipo` when 1 then `mov`.`monto` else 0 end)) AS `tipo1`,sum((case `cta1`.`Tipo` when 2 then `mov`.`monto` else 0 end)) AS `tipo2` from ((`movimiento_cab` `cab` join `movimiento_cta` `mov` on((`cab`.`id` = `mov`.`id_cabecera`))) join `cuenta` `cta1` on((`mov`.`id_cuenta` = `cta1`.`id`))) group by `cab`.`id_cabecera`) */;

/*View structure for view v_totaldetallepedido */

/*!50001 DROP TABLE IF EXISTS `v_totaldetallepedido` */;
/*!50001 DROP VIEW IF EXISTS `v_totaldetallepedido` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_totaldetallepedido` AS select `det`.`id` AS `id`,`det`.`id_cabecera` AS `id_cabecera`,`det`.`id_producto` AS `id_prod`,`pro`.`Codigo` AS `cod_prod`,`pro`.`Nombre` AS `nom_prod`,`pro`.`Descripcion` AS `des_prod`,`det`.`costo` AS `costo_un`,`det`.`valor_cli` AS `venta_un`,sum(`det`.`cantidad`) AS `cantidad`,sum((`det`.`costo` * `det`.`cantidad`)) AS `det_costo`,sum((`det`.`valor_cli` * `det`.`cantidad`)) AS `det_venta`,sum(((`det`.`valor_cli` * `det`.`cantidad`) - (`det`.`costo` * `det`.`cantidad`))) AS `det_ganancia`,sum((((`det`.`valor_cli` * `det`.`cantidad`) - (`det`.`costo` * `det`.`cantidad`)) / (case `cab`.`comision` when 1 then 2 when 0 then 1 end))) AS `det_ganancia_2` from ((`detalle` `det` join `producto` `pro` on((`det`.`id_producto` = `pro`.`id`))) join `cabecera` `cab` on((`cab`.`id` = `det`.`id_cabecera`))) group by `det`.`id_cabecera`,`det`.`id_producto`,`pro`.`Codigo`,`pro`.`Nombre`,`pro`.`Descripcion`,`det`.`id`,`det`.`costo`,`det`.`valor_cli` */;

/*View structure for view v_totaldetallepedido1linea */

/*!50001 DROP TABLE IF EXISTS `v_totaldetallepedido1linea` */;
/*!50001 DROP VIEW IF EXISTS `v_totaldetallepedido1linea` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_totaldetallepedido1linea` AS select `v_det`.`id_cabecera` AS `id_cabecera`,sum(`v_det`.`det_costo`) AS `costo_tot`,sum(`v_det`.`det_venta`) AS `venta_tot`,sum((case `cab`.`ConFactura` when 1 then (`v_det`.`det_venta` * 0.19) else 0 end)) AS `iva_tot`,sum(`v_det`.`det_ganancia`) AS `ganancia_tot`,sum(`v_det`.`det_ganancia_2`) AS `ganancia2_tot` from (`v_totaldetallepedido` `v_det` join `v_cabecera` `cab` on((`v_det`.`id_cabecera` = `cab`.`id`))) group by `v_det`.`id_cabecera` */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
