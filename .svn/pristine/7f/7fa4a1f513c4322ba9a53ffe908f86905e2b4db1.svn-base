ALTER VIEW `v_totaldetallepedido1linea` AS 
SELECT
	  `v_det`.`id_cabecera` AS `id_cabecera`,
	  SUM(`v_det`.`det_costo`) AS `costo_tot`,
	  SUM(`v_det`.`det_venta`) AS `venta_tot`,
	  SUM(`v_det`.`det_venta` * 
	  
		(CASE cab.confactura 
		WHEN 1 THEN 0.19
		ELSE 0 END)
	  
	  ) AS `iva_tot`,
	  SUM(`v_det`.`det_ganancia`) AS `ganancia_tot`,
	  SUM(`v_det`.`det_ganancia_2`) AS `ganancia2_tot`

FROM `v_totaldetallepedido` `v_det`
INNER JOIN v_cabecera cab ON v_det.id_cabecera = cab.id

GROUP BY `v_det`.`id_cabecera`
