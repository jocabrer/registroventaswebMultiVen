<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
	<?php echo $titleHeader; ?>
	<small>
	<?php echo $descHeader ?>
	</small>
  </h1>
  <ol class="breadcrumb">
	<li><a href="<?php echo base_url(); ?>"><i class="fa fa-dashboard"></i> Inicio</a></li>
	<li><a href="<?php echo base_url($currentClass); ?>"><?php echo $currentClass ?></a></li>
	<li class="active"><?php echo $currentAction ?></li>
  </ol>
</section>

<section class="content">
 <div class="box">
 	<div class="box-header with-border">
  		<h3>Pedidos</h3>
  		<div class="box-tools pull-right">
  			<a href="<?php echo base_url(); ?>Pedido/nuevoPedido/" class="btn btn-default"><i class="fa fa-edit"></i> Nuevo Pedido</a>
  			<!--  <a class="btn" id="btn_listar"><i class="fa fa-repeat"></i> Refrescar</a>-->
  		</div><!-- .Box Tools -->
  	</div><!-- Box Header -->
  	<div class="box-body">		
  	<div class="row">
  		<div class="col-lg-6 col-md-12 col-xs-12">
	  		<div class="table-responsive">
				<table class="table">
				<tbody>
						  <tr>
							<th>Total Ven1</th>
							<td><label id="lbl_totalSaldoVen1"></label></td>
						  </tr>
						  <tr>
							<th>Total Ven2</th>
							<td><label id="lbl_totalSaldoVen2"></label></td>
						  </tr>
						  <tr>
							<th>Total Fabrica</th>
							<td><label id="lbl_totalSaldoFab"></label></td>
						  </tr>
				</tbody>
				</table>
			</div><!-- Div class table -->
		</div><!-- COL -->
  	</div><!-- Row -->
	<div class="row">
		<div class="col-lg-12 col-md-12 col-xs-12">	
		 <div id="toolbar">
            <div class="form-inline" role="form">
                <div class="form-group">
                    <span>Estados: </span>
                    <select style="width:100%;"  id="sl_estado" class="multiselect" multiple>
					<?php
					foreach($vEstados as $est) {
						  echo "<option "; 
						   
						  echo " value = \" ". $est['id']."\" ";
						  if ($est['id']<3)
						  	echo " selected=\"selected\"";
					 ?>
					>
					 <?php echo $est['descripcion']; ?>
						  
  					</option>
  					<?php }?>	
					</select>
                </div>
                <div class="form-group">
                    <span>Limit: </span>
                    <input name="limit" class="form-control" type="number" value="20" style="width:80px;">
                </div>
                 <div class="form-group">
                 	Comisi&oacute;n
                 	<select id="sl_comision" class="form-control">
                 		<option value="-1">-</option>
                 		<option value="0">No</option>
                 		<option value="1">Si</option>
                 	</select>
                 </div>
                <div class="form-group">
                    <input name="search" class="form-control" type="text" placeholder="Buscar">
                </div>
                <button id="ok" type="submit" class="btn btn-default">OK</button>
            </div>
        </div>
		<table id="tabla_resultado"
			   data-toolbar="#toolbar"
			   data-method="post"
			   
       		   data-show-footer="false"
               data-show-columns="true"
               data-show-refresh="true"
			   data-show-export="true"
			   data-side-pagination="server"
			   
			   data-pagination="true"
			   data-page-list="[10, 25, 50, 100, Todos]"
               
			   data-toggle="table"
			   data-query-params="queryParams"
			   
			   data-response-handler="responseHandler"
			   data-url="<?php echo base_url(); ?>Pedido/listadoPedidos/">
	     <thead>
         <tr>
                 <th data-field="numeroPedido"  data-sortable="true" data-formatter="f_idpedido">Nro.</th>
                 <th data-field="numeroPedido"  data-sortable="true"  data-formatter="f_comprobante">Comp.</th>
                 <th data-field="cli_nom" data-filterby="true"  data-formatter="f_cliente">Cliente</th>
                 <th data-field="estado_sec"  data-sortable="true" data-align="left" data-formatter="FormatoEstado">Estado</th>
				 <th data-field="comision"  data-sortable="true" data-align="left"  data-formatter="FormatoComision">Comisi&oacute;n</th>
				 <th data-field="confactura"  data-sortable="true" data-align="center" data-visible="false">Factura</th>
				 <th data-field="est_fec_ing" data-sortable="true" data-visible="false">Ingresado</th>
				 <th data-field="est_fec_estactual" data-sortable="true" data-visible="false">Fecha Act</th>
				 <th data-field="diastranscurridos" data-sortable="true"  data-visible="false">D&iacute;as T.</th>
				 <th data-field="totalAPagar" data-sortable="true" data-formatter="PriceFormatter"  data-visible="true" data-align="right" >Venta Total</th>
				 <th data-field="SaldoCliente" data-sortable="true" data-formatter="PriceFormatter"  data-visible="true" data-align="right" >Saldo Cliente</th>
				 <th data-field="SaldoVendedor1"  data-sortable="true" data-formatter="PriceFormatter"  data-visible="true" data-align="right" >Saldo VEN1</th>
				 <th data-field="SaldoVendedor2"  data-sortable="true" data-formatter="PriceFormatter"  data-visible="true" data-align="right" >Saldo VEN2</th>
				 <th data-field="SaldoFabrica" data-sortable="true" data-formatter="PriceFormatter"  data-visible="true" data-align="right" >Saldo F&aacute;brica</th>	
            </tr>
         </thead>
		</table>
		</div><!--  col -->
	</div><!-- ROW -->
	</div><!-- Div class box body -->
</div><!-- .div box -->
</section><!-- /.content -->

</div><!-- /.content-wrapper -->


<script type="text/javascript">

	//http://davidstutz.github.io/bootstrap-multiselect/
	//https://github.com/wenzhixin/bootstrap-table/blob/master/src/extensions/export/README.md
	$(document).ready(function() {

		$sl_comision = $('#sl_comision');

		$sl_comision.change(function(){ $table.bootstrapTable('refresh'); });
		
		
	    $("#sl_estado").multiselect({ 
	        nonSelectedText: 'Filtrar los estados!',    
	        maxHeight: 200,
	        buttonWidth: '200px',
	        dropRight: true,
	        enableClickableOptGroups: true
	    });
		var $table = $('#tabla_resultado'),
	    $ok = $('#ok');  
		$ok.click(function () {$table.bootstrapTable('refresh');});

		//$table.tableExport({type:'csv'});
	});
		
	
	/*
	*Totaliza la respuesta.-
	*/
	function calculaTotalesListado(res){
		var totalSaldo1=0;
		var totalSaldo2=0;
		var totalSaldoFab=0;
		for (var i in res) {
		  for (var j in res[i]) {
			  totalSaldo1 += parseInt(res[i][j].SaldoVendedor1);
			  totalSaldo2 += parseInt(res[i][j].SaldoVendedor2);
			  totalSaldoFab += parseInt(res[i][j].SaldoFabrica);
		  }
		}
		$('#lbl_totalSaldoVen1').text(PriceFormatter(totalSaldo1));
		$('#lbl_totalSaldoVen2').text(PriceFormatter(totalSaldo2));
		$('#lbl_totalSaldoFab').text(PriceFormatter(totalSaldoFab));
	}
	
	/**
	 * Procesa la respuesta del metodo que carga vía ajax los datos a la tabla.
	 */
	function responseHandler(res){
		calculaTotalesListado(res);
		return res;
	}
	/**
	 * Funcion que setea los parametros.
	 */
	function queryParams(params) {
		var slestado = $('#sl_estado');
		params['slestado'] = slestado.val();

		var slcomision = $('#sl_comision');
		params['slcomision'] = slcomision.val();

		
        $('#toolbar').find('input[name]').each(function () {
            params[$(this).attr('name')] = $(this).val();
        });
	    return params;
	}
	/*
	 * Formatea el link hacia el detalle del pedido
	 */
	function f_idpedido(data){
		return['<a href="<?php echo base_url(); ?>Pedido/nuevoPedido/',data,'">',data,'</a>'].join('');
	}

	function f_comprobante(data){
		return['<a href="<?php echo base_url(); ?>Comprobante/verComprobante/',data,'">','<i class="fa fa-fw fa-file-o"></i>','</a>'].join('');
	}
	
	function f_cliente(value, row, index){
		return['<a href="<?php echo base_url(); ?>Cliente/edicion/',row.cli_id,'">',row.cli_nom,'</a>'].join('');
	}

	
	
</script>
 


	

